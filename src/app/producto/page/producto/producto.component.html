<div class="container mt-4">
  <h2>Registrar Productos</h2>

  <div class="row">
    <!-- Formulario -->
    <div class="col-md-4">
      <div class="card">
        <div class="card-header bg-dark text-white">
          Formulario de Productos
        </div>
        <div class="card-body">
          <form [formGroup]="productoForm" (ngSubmit)="onSave()">

            <!-- Descripci칩n -->
            <div class="mb-3">
              <label class="form-label">Descripci칩n</label>
              <input type="text" class="form-control" formControlName="descripcion" [disabled]="formDisabled">
              <div class="text-danger mt-1"
                *ngIf="productoForm.get('descripcion')?.invalid && productoForm.get('descripcion')?.touched">
                La descripci칩n es obligatoria
              </div>
            </div>

            <!-- Precio compra -->
            <div class="mb-3">
              <label class="form-label">Precio de Compra</label>
              <input type="number" class="form-control" formControlName="precioCompra" [disabled]="formDisabled">
              <div class="text-danger mt-1"
                *ngIf="productoForm.get('precioCompra')?.invalid && productoForm.get('precioCompra')?.touched">
                Debe agregar el precio de compra
              </div>
            </div>

            <!-- Precio venta -->
            <div class="mb-3">
              <label class="form-label">Precio de Venta</label>
              <input type="number" class="form-control" formControlName="precioVenta" [disabled]="formDisabled">
              <div class="text-danger mt-1"
                *ngIf="productoForm.get('precioVenta')?.invalid && productoForm.get('precioVenta')?.touched">
                Debe agregar el precio de venta
              </div>
            </div>

            <!-- Stock -->
            <div class="mb-3">
              <label class="form-label">Stock</label>
              <input type="number" class="form-control" formControlName="stock" [disabled]="formDisabled">
              <div class="text-danger mt-1"
                *ngIf="productoForm.get('stock')?.invalid && productoForm.get('stock')?.touched">
                Debe cargar la cantidad en stock
              </div>
            </div>

            <!-- Categor칤a con bot칩n lupa -->
            <div class="mb-3">
              <label class="form-label">Categor칤a</label>
              <div class="input-group">
                <input type="text" class="form-control" 
                  [value]="getCategoriaDescripcion(productoForm.get('categoria')?.value)"
                  placeholder="Seleccionar categor칤a" readonly>
                <button type="button" class="btn btn-dark" (click)="abrirModalCategoria()" [disabled]="formDisabled">
                  <img src="assets/lupa.png" alt="Buscar" width="20" height="20">
                </button>
              </div>
              <div class="text-danger mt-1"
                *ngIf="productoForm.get('categoria')?.invalid && productoForm.get('categoria')?.touched">
                Debe agregar una categor칤a
              </div>
            </div>

            <!-- Activo -->
            <div class="mb-3 form-check">
              <input type="checkbox" class="form-check-input" formControlName="activo" [disabled]="formDisabled">
              <label class="form-check-label">Activo</label>
            </div>

            <!-- Botones -->
            <div class="d-flex flex-wrap mt-3">
              <button type="button" class="btn btn-dark me-2 mb-2" (click)="onNew()" [disabled]="!formDisabled">
                <img src="assets/anhadir.png" alt="Nuevo" width="20" height="20" class="me-2">
                Nuevo
              </button>
              <button type="submit" class="btn btn-dark me-2 mb-2" [disabled]="productoForm.invalid || formDisabled">
                <img [src]="editingId ? 'assets/actualizar.png' : 'assets/guardar.png'" width="20" class="me-2">
                {{ editingId ? 'Actualizar' : 'Guardar' }}
              </button>
              <button type="button" class="btn btn-dark me-2 mb-2" (click)="editingId ? onDelete(editingId) : null"
                [disabled]="editingId === null">
                <img src="assets/eliminar.png" alt="Eliminar" width="20" height="20" class="me-2">
                Eliminar
              </button>
              <button type="button" class="btn btn-dark me-2 mb-2" (click)="onCancel()" [disabled]="formDisabled">
                <img src="assets/cancelar.png" alt="Cancelar" width="20" height="20" class="me-2">
                Cancelar
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Tabla productos -->
    <div class="col-md-8">
      <div class="mb-3">
        <input type="text" class="form-control" placeholder="Buscar Productos" [(ngModel)]="searchText">
      </div>
      <table class="table table-striped table-bordered" *ngIf="filteredProductos.length > 0">
        <thead class="table-dark">
          <tr>
            <th>ID</th>
            <th>Descripci칩n</th>
            <th>Precio Compra</th>
            <th>Precio Venta</th>
            <th>Stock</th>
            <th>Activo</th>
            <th>Categor칤a</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let producto of filteredProductos" (click)="onSelect(producto)" style="cursor:pointer;">
            <td>{{ producto.id }}</td>
            <td>{{ producto.descripcion }}</td>
            <td>{{ producto.precioCompra }}</td>
            <td>{{ producto.precioVenta }}</td>
            <td>{{ producto.stock }}</td>
            <td>{{ producto.activo ? 'S칤' : 'No' }}</td>
            <td>{{ producto.categoria?.descripcion }}</td>
          </tr>
        </tbody>
      </table>
      <div *ngIf="filteredProductos.length === 0" class="text-center mt-3">
        <h5>No hay productos registrados.</h5>
      </div>
    </div>
  </div>
</div>

<!-- 游댳 Modal Buscar Categor칤a -->
<div class="modal fade" id="categoriaModal" tabindex="-1" aria-labelledby="categoriaModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-dark text-white">
        <h2 class="modal-title" id="categoriaModalLabel">Buscar Categor칤a</h2>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input type="text" class="form-control mb-3" placeholder="Buscar..."
          [(ngModel)]="searchCategoria" (input)="filtrarCategorias()">

        <ul class="list-group">
          <li class="list-group-item list-group-item-action"
              *ngFor="let cat of categoriasFiltradas"
              (click)="seleccionarCategoria(cat)" style="cursor:pointer;">
            {{ cat.descripcion }}
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
